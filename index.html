<!DOCTYPE html>
<html lang="ru">
<head>
<script src="https://unpkg.com/wavesurfer.js">



function renderWaveform(blob, filename) {
  if (!blob || blob.size === 0) {
    console.warn('Skipping empty or invalid blob:', filename);
    return;
  }

  const container = document.createElement('div');
  container.style.marginBottom = '20px';
  container.style.border = '2px inset #808080';
  container.style.padding = '10px';
  container.style.background = '#e0e0e0';
  container.style.overflowX = 'auto';

  const title = document.createElement('div');
  try {
    title.textContent = decodeURIComponent(filename);
  } catch {
    title.textContent = filename;
  }
  title.style.fontFamily = "'Courier New', monospace";
  title.style.fontSize = '14px';
  title.style.marginBottom = '6px';
  title.style.wordBreak = 'break-word';

  const wave = document.createElement('div');
  wave.style.width = '100%';
  wave.style.minHeight = '64px';
  wave.style.height = '64px';

  const button = document.createElement('button');
  button.textContent = '▶️ Play';
  button.style.marginTop = '6px';
  button.style.fontFamily = "'Courier New', monospace";

  const wavesurfer = WaveSurfer.create({
    container: wave,
    waveColor: '#000',
    progressColor: '#000080',
    height: 64,
    barWidth: 1.4,
    minPxPerSec: 100,
    responsive: true,
    cursorColor: '#ff0000',
    splitChannels: false
  });

  let didRender = false;
  const fallbackTimeout = setTimeout(() => {
    if (!didRender) {
      const failNote = document.createElement('div');
      failNote.textContent = '⚠️ Failed to render waveform';
      failNote.style.color = 'red';
      failNote.style.fontSize = '13px';
      container.appendChild(title);
      container.appendChild(failNote);
      document.getElementById('waveform-list').appendChild(container);
    }
  }, 4000);

  wavesurfer.on('ready', () => {
    clearTimeout(fallbackTimeout);
    didRender = true;
    container.appendChild(title);
    container.appendChild(wave);
    container.appendChild(button);
    document.getElementById('waveform-list').appendChild(container);
  });

  wavesurfer.on('error', (e) => {
    console.error('WaveSurfer error:', e);
  });

  wavesurfer.loadBlob(blob);

  button.onclick = () => {
    if (wavesurfer.isPlaying()) {
      wavesurfer.pause();
      button.textContent = '▶️ Play';
    } else {
      wavesurfer.play();
      button.textContent = '⏸ Pause';
    }
  };
}

</script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js">



function renderWaveform(blob, filename) {
  if (!blob || blob.size === 0) {
    console.warn('Skipping empty or invalid blob:', filename);
    return;
  }

  const container = document.createElement('div');
  container.style.marginBottom = '20px';
  container.style.border = '2px inset #808080';
  container.style.padding = '10px';
  container.style.background = '#e0e0e0';
  container.style.overflowX = 'auto';

  const title = document.createElement('div');
  try {
    title.textContent = decodeURIComponent(filename);
  } catch {
    title.textContent = filename;
  }
  title.style.fontFamily = "'Courier New', monospace";
  title.style.fontSize = '14px';
  title.style.marginBottom = '6px';
  title.style.wordBreak = 'break-word';

  const wave = document.createElement('div');
  wave.style.width = '100%';
  wave.style.minHeight = '64px';
  wave.style.height = '64px';

  const button = document.createElement('button');
  button.textContent = '▶️ Play';
  button.style.marginTop = '6px';
  button.style.fontFamily = "'Courier New', monospace";

  const wavesurfer = WaveSurfer.create({
    container: wave,
    waveColor: '#000',
    progressColor: '#000080',
    height: 64,
    barWidth: 1.4,
    minPxPerSec: 100,
    responsive: true,
    cursorColor: '#ff0000',
    splitChannels: false
  });

  let didRender = false;
  const fallbackTimeout = setTimeout(() => {
    if (!didRender) {
      const failNote = document.createElement('div');
      failNote.textContent = '⚠️ Failed to render waveform';
      failNote.style.color = 'red';
      failNote.style.fontSize = '13px';
      container.appendChild(title);
      container.appendChild(failNote);
      document.getElementById('waveform-list').appendChild(container);
    }
  }, 4000);

  wavesurfer.on('ready', () => {
    clearTimeout(fallbackTimeout);
    didRender = true;
    container.appendChild(title);
    container.appendChild(wave);
    container.appendChild(button);
    document.getElementById('waveform-list').appendChild(container);
  });

  wavesurfer.on('error', (e) => {
    console.error('WaveSurfer error:', e);
  });

  wavesurfer.loadBlob(blob);

  button.onclick = () => {
    if (wavesurfer.isPlaying()) {
      wavesurfer.pause();
      button.textContent = '▶️ Play';
    } else {
      wavesurfer.play();
      button.textContent = '⏸ Pause';
    }
  };
}

</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KO II Audio Tool v1.41</title>
  <style>
    body {
      background: #fff;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .window {
      width: 100%;
      max-width: 420px;
      background: #c0c0c0;
      border: 2px solid #000;
      box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5);
      padding: 10px;
      box-sizing: border-box;
    }
    .title-bar {
      background: #000080;
      color: #fff;
      padding: 4px 8px;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .title-bar button {
      width: 18px;
      height: 18px;
      border: none;
      background: #c0c0c0;
      cursor: pointer;
    }
    .title-bar .minimize { background: #fff; }
    .title-bar .close { background: #ff0000; }

    .content {
      padding: 10px 0;
    }

    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .options label,
    .settings label {
      font-size: 16px;
    }

    .options input[type="radio"] {
      margin-right: 5px;
      transform: scale(1.3);
    }

    .settings {
      margin-top: 10px;
      padding: 5px;
      background: #2d7038;
    }

    .slider {
      width: 100%;
      height: 12px;
      background: #000;
      appearance: none;
      outline: none;
    }

    .slider::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      background: #ffd700;
      cursor: pointer;
    }

    .drop-zone {
      border: 2px dashed #000;
      padding: 14px;
      text-align: center;
      background: rgba(255, 255, 255, 0.3);
      margin-top: 12px;
      position: relative;
    }

    .drop-zone input[type="file"] {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }

    .drop-zone span {
      pointer-events: none;
      font-size: 16px;
    }

    #file-info {
      margin-top: 10px;
      font-size: 14px;
      text-align: left;
    }

    button#select-file-button {
      width: 100%;
      margin-top: 10px;
      background: #c0c0c0;
      border: 2px solid #000;
      color: #000;
      font-family: 'Courier New', monospace;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
    }

    audio#player {
      width: 100%;
      margin-top: 12px;
    }

    #overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 999;
    }

    #win95-loader {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 320px;
      padding: 12px;
      background: #c0c0c0;
      border: 2px solid #000;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      color: #000;
      display: none;
      z-index: 1000;
    }

    .progress-bar-container {
      background: #fff;
      border: 2px inset #808080;
      height: 18px;
      margin-top: 8px;
      display: flex;
      padding: 2px;
      gap: 1px;
      justify-content: flex-start;
    }

    .progress-segment {
      width: 6px;
      height: 100%;
      background: #c0c0c0;
    }

    .progress-segment.active {
      background: #000080;
    }
  
    .slider-wrapper {
      display: flex;
      align-items: center;
      margin-top: 8px;
      gap: 8px;
    }

    .slider-value {
      background: #fff;
      border: 2px inset #808080;
      padding: 2px 6px;
      font-size: 14px;
      min-width: 36px;
      text-align: center;
      font-family: 'Courier New', monospace;
      color: #000;
    }


.win95-inset {
  border: 2px inset #808080;
  background: #c0c0c0;
  padding: 6px;
  margin-bottom: 6px;
}

</style>

<style>
.win95-box {
  border: 2px inset #fff;
  background: #c0c0c0;
  padding: 4px;
  font-family: "Courier New", monospace;
  margin-bottom: 10px;
}
.group-title {
  font-weight: bold;
  margin-bottom: 2px;
}
.win95-listbox {
  list-style: none;
  padding: 0;
  margin: 0;
  border: 1px solid black;
  background: white;
}
.win95-listbox li {
  padding: 2px 6px;
  cursor: pointer;
}
.win95-listbox li.selected {
  background-color: navy;
  color: white;
}
</style>

</head>
<body>
  <div class="window">
    <div class="title-bar">
      <span>KO II Audio Tool — v1.50</span>
      <div>
        <button class="minimize">-</button>
        <button class="close">X</button>
      </div>
    </div>
    <div class="content">
      
<div style="display: flex; gap: 8px; margin-bottom: 10px;">
  <div class="win95-inset" style="flex: 1;">
    <label>FIDELITY</label><br>
     CD (16/46)<br>
     SP-1200 8 Bit<br>
     SP-1200 16 Bit<br>
     SK-1 (8/9)
  </div>
  <div class="win95-inset" style="flex: 1;">
    <label>CHANNELS</label><br>
     Stereo<br>
     Mono
  </div>
</div>

      <div class="settings win95-inset">
        <label>EP-133 KO II SETTINGS</label>
        
    <div class="slider-wrapper">
      <label>Pitch</label>
      <input type="range" class="slider" id="pitch-slider" min="0" max="127" value="64" oninput="updateSliderValue('pitch')">
      <span class="slider-value" id="pitch-value">64</span>
    </div>
    <div class="slider-wrapper">
      <label>Release</label>
      <input type="range" class="slider" id="release-slider" min="0" max="255" value="128" oninput="updateSliderValue('release')">
      <span class="slider-value" id="release-value">128</span>
    </div>
    
      </div>
      <div class="drop-zone" id="drop-zone">
        <input type="file" id="audio-upload" accept=".mp3,.wav,.ogg,audio/*" multiple />
        <span>DRAG AND DROP OR SELECT AUDIO FILES</span>
        <div id="file-info"></div>
      </div>
      <div id="waveform-list" style="margin-top: 10px;"></div>
<button id="select-file-button">Select Audio Files</button>
          </div>
  </div>

  <div id="overlay">
    <div id="win95-loader">
      <div>Copying...</div>
      <div>From KO Tool to Player</div>
      <div class="progress-bar-container" id="segment-container"></div>
    </div>
  </div>












<script>
let editorState = {
  fidelity: "cd",
  channels: "stereo"
};

function applyEditorState(name, value) {
  editorState[name] = value;

  // Вызов функции, которая применяет параметры к аудио (имитация)
  if (typeof updateInput === "function") {
    updateInput(name, value);
  } else if (typeof setEditorParam === "function") {
    setEditorParam(name, value);
  } else {
    console.log(`[FAKE APPLY] ${name} = ${value}`);
  }
}

function initWin95List(id) {
  const list = document.getElementById(id);
  const items = list.querySelectorAll("li");
  items.forEach(item => {
    item.addEventListener("click", () => {
      items.forEach(i => i.classList.remove("selected"));
      item.classList.add("selected");

      const paramName = item.dataset.name;
      const paramValue = item.dataset.value;

      applyEditorState(paramName, paramValue);

      const event = new CustomEvent("inputChange", {
        detail: { name: paramName, value: paramValue }
      });
      document.dispatchEvent(event);
    });
  });
}

document.addEventListener("DOMContentLoaded", () => {
  initWin95List("fidelity-options");
  initWin95List("channel-options");
});

// Глобальный слушатель события inputChange
document.addEventListener("inputChange", (e) => {
  const { name, value } = e.detail || {};
  if (name && value) {
    applyEditorState(name, value);
  }
});
</script>

</body>
</html>