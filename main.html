<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KO II Audio Tool</title>
  <style>
    body {
      font-family: monospace;
      background-color: #c0c0c0;
      margin: 0;
      padding: 20px;
    }
    .window {
      border: 2px solid black;
      background-color: #e0e0e0;
      width: 90%;
      max-width: 600px;
      margin: 0 auto;
      padding: 10px;
      box-shadow: 5px 5px 0 #808080;
    }
    .title-bar {
      background: navy;
      color: white;
      padding: 4px 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .title-bar button {
      background: red;
      color: white;
      border: none;
      font-weight: bold;
      padding: 2px 6px;
    }
    .section {
      margin-top: 10px;
    }
    label {
      display: inline-block;
      margin-right: 10px;
    }
    .drop-zone {
      border: 2px dashed black;
      padding: 20px;
      text-align: center;
      margin-top: 10px;
      cursor: pointer;
      background: white;
      position: relative;
    }
    #progress-overlay {
      display: none;
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(192,192,192,0.8);
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10;
    }
    .progress-bar {
      display: flex;
      gap: 2px;
      margin-top: 10px;
    }
    .progress-segment {
      width: 8px;
      height: 20px;
      background: lightgray;
    }
    .progress-segment.active {
      background: navy;
    }
    audio {
      width: 100%;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="window">
    <div class="title-bar">
      <div>KO II Audio Tool</div>
      <button>-</button><button>X</button>
    </div>

    <div class="section">
      <strong>FIDELITY</strong><br/>
      <label><input type="radio" name="fidelity" value="cd" /> CD (16/46)</label>
      <label><input type="radio" name="fidelity" value="sp8" /> SP-1200 8 Bit</label>
      <label><input type="radio" name="fidelity" value="sp16" /> SP-1200 16 Bit</label>
      <label><input type="radio" name="fidelity" value="sk1" checked /> SK-1 (8/9)</label>
    </div>

    <div class="section">
      <strong>CHANNELS</strong><br/>
      <label><input type="radio" name="channels" value="stereo" /> Stereo</label>
      <label><input type="radio" name="channels" value="mono" checked /> Mono</label>
    </div>

    <div class="section">
      <div style="background: green; color: black; padding: 4px;">
        EP-133 KO II SETTINGS Pitch<br/>
        <input type="range" min="0" max="100" value="50"/><br/>
        Release<br/>
        <input type="range" min="0" max="100" value="50"/>
      </div>
    </div>

    <div class="drop-zone" id="drop-zone">
      <div id="file-info">DRAG AND DROP OR SELECT AUDIO FILES</div>
      <input type="file" id="audio-upload" accept=".mp3,.wav,.ogg,audio/*" multiple hidden />
      <div id="progress-overlay">
        <div>Copying...</div>
        <div class="progress-bar" id="progress-bar"></div>
      </div>
    </div>

    <audio id="audio-player" controls></audio>
  </div>

  <script>
    const dropZone = document.getElementById("drop-zone");
    const input = document.getElementById("audio-upload");
    const audioPlayer = document.getElementById("audio-player");
    const fileInfo = document.getElementById("file-info");
    const progressOverlay = document.getElementById("progress-overlay");
    const progressBar = document.getElementById("progress-bar");

    dropZone.addEventListener("click", () => input.click());

    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.style.background = "#ddd";
    });

    dropZone.addEventListener("dragleave", () => {
      dropZone.style.background = "white";
    });

    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.style.background = "white";
      handleFiles(e.dataTransfer.files);
    });

    input.addEventListener("change", () => {
      handleFiles(input.files);
    });

    async function animateSegments(start, end) {
      const segments = document.querySelectorAll(".progress-segment");
      for (let i = start; i <= end; i++) {
        segments[i].classList.add("active");
        await new Promise(res => setTimeout(res, 50));
      }
    }

    async function handleFiles(files) {
      if (!files.length) return;

      progressOverlay.style.display = "flex";
      progressBar.innerHTML = "";
      const totalSegments = 30;
      for (let i = 0; i < totalSegments; i++) {
        const seg = document.createElement("div");
        seg.className = "progress-segment";
        progressBar.appendChild(seg);
      }

      const segmentsPerFile = Math.floor(totalSegments / files.length);

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const startIndex = i * segmentsPerFile;
        const endIndex = startIndex + segmentsPerFile - 1;

        await animateSegments(startIndex, endIndex);

        const originalSize = (file.size / 1024 / 1024).toFixed(2);
        const processedSize = (originalSize / 2).toFixed(2);

        fileInfo.innerHTML = \`
          \${file.name}<br/>
          FIDELITY: \${document.querySelector('input[name="fidelity"]:checked').value.toUpperCase()} | 
          CHANNELS: \${document.querySelector('input[name="channels"]:checked').value.toUpperCase()}<br/>
          SIZE: \${originalSize} MB → \${processedSize} MB
        \`;

        const url = URL.createObjectURL(file);
        audioPlayer.src = url;
        audioPlayer.play();
        await new Promise(res => setTimeout(res, 1000));
      }
// Мгновенно заполняем оставшиеся сегменты, если есть незаполненные
const segments = document.querySelectorAll('.progress-segment');
segments.forEach(seg => seg.classList.add('active'));
      // Мгновенное завершение прогресса
      document.querySelectorAll(".progress-segment").forEach(seg => seg.classList.add("active"));
      setTimeout(() => {
        progressOverlay.style.display = "none";
      }, 500);
    }
  </script>
</body>
</html>
