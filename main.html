<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KO II Audio Tool</title>
  <style>
    body {
      background-color: #aaa;
      font-family: monospace;
      margin: 0;
      padding: 0;
    }
    .window {
      width: 95%;
      max-width: 500px;
      margin: 30px auto;
      border: 2px solid black;
      background-color: silver;
      box-shadow: 4px 4px 0 black;
      position: relative;
    }
    .title-bar {
      background: navy;
      color: white;
      padding: 2px 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .window-body {
      padding: 10px;
    }
    fieldset {
      margin-bottom: 10px;
    }
    .green-box {
      background-color: #387c44;
      color: black;
      padding: 6px;
      margin-bottom: 10px;
    }
    .slider {
      width: 100%;
    }
    .drop-zone {
      border: 2px dashed black;
      padding: 10px;
      text-align: center;
      margin-bottom: 10px;
      cursor: pointer;
    }
    .file-info {
      font-size: 14px;
      margin-top: 5px;
    }
    .progress-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(150,150,150,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .progress-box {
      background-color: white;
      border: 2px solid black;
      padding: 15px;
      width: 250px;
      text-align: left;
      font-size: 14px;
      box-shadow: 3px 3px 0 black;
    }
    .progress-bar {
      display: flex;
      margin-top: 10px;
    }
    .progress-segment {
      width: 6px;
      height: 16px;
      margin-right: 1px;
      background-color: lightgray;
    }
    .progress-segment.active {
      background-color: navy;
    }
    audio {
      width: 100%;
    }
    .select-button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 2px solid black;
      background: #e0e0e0;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="window">
    <div class="title-bar">
      <span>KO II Audio Tool</span>
      <div><button>-</button> <button style="background:red;color:white;">X</button></div>
    </div>
    <div class="window-body">
      <fieldset>
        <legend>FIDELITY</legend>
        <label><input type="radio" name="fidelity" value="cd" /> CD (16/46)</label><br/>
        <label><input type="radio" name="fidelity" value="sp8" /> SP-1200 8 Bit</label><br/>
        <label><input type="radio" name="fidelity" value="sp16" /> SP-1200 16 Bit</label><br/>
        <label><input type="radio" name="fidelity" value="sk1" checked/> SK-1 (8/9)</label>
      </fieldset>
      <fieldset>
        <legend>CHANNELS</legend>
        <label><input type="radio" name="channels" value="stereo" /> Stereo</label><br/>
        <label><input type="radio" name="channels" value="mono" checked /> Mono</label>
      </fieldset>
      <div class="green-box">
        <b>EP-133 KO II SETTINGS</b><br/>
        Pitch<br/><input type="range" class="slider" min="0" max="100" value="50"/><br/>
        Release<br/><input type="range" class="slider" min="0" max="100" value="50"/>
      </div>
      <div class="drop-zone" id="dropZone">
        DRAG AND DROP OR SELECT AUDIO FILES
        <div class="file-info" id="fileInfo"></div>
      </div>
      <button class="select-button" onclick="document.getElementById('fileInput').click()">Select Audio Files</button>
      <input type="file" id="audio-upload" accept=".mp3,.wav,.ogg,audio/*" multiple />none"/>
      <audio id="audioPlayer" controls></audio>
    </div>
  </div>

  <div class="progress-overlay" id="progressOverlay">
    <div class="progress-box">
      <div>Copying...<br/>From KO Tool to Player</div>
      <div class="progress-bar" id="progressBar"></div>
    </div>
  </div>

  <script>
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("fileInput");
    const fileInfo = document.getElementById("fileInfo");
    const audioPlayer = document.getElementById("audioPlayer");
    const progressOverlay = document.getElementById("progressOverlay");
    const progressBar = document.getElementById("progressBar");

    dropZone.addEventListener("click", () => fileInput.click());

    dropZone.addEventListener("dragover", e => {
      e.preventDefault();
      dropZone.style.backgroundColor = "#ccc";
    });
    dropZone.addEventListener("dragleave", () => {
      dropZone.style.backgroundColor = "";
    });
    dropZone.addEventListener("drop", e => {
      e.preventDefault();
      dropZone.style.backgroundColor = "";
      handleFiles(e.dataTransfer.files);
    });

    fileInput.addEventListener("change", () => {
      handleFiles(fileInput.files);
    });

    async function handleFiles(files) {
      if (!files.length) return;

      progressOverlay.style.display = "flex";
      progressBar.innerHTML = "";
      const totalSegments = 30;
      for (let i = 0; i < totalSegments; i++) {
        const seg = document.createElement("div");
        seg.className = "progress-segment";
        progressBar.appendChild(seg);
      }

      const segmentsPerFile = Math.floor(totalSegments / files.length);

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const startIndex = i * segmentsPerFile;
        const endIndex = startIndex + segmentsPerFile - 1;

        await animateSegments(startIndex, endIndex);

        const originalSize = (file.size / 1024 / 1024).toFixed(2);
        const processedSize = (originalSize / 2).toFixed(2);

        fileInfo.innerHTML = `
          ${file.name}<br/>
          FIDELITY: ${document.querySelector('input[name="fidelity"]:checked').value.toUpperCase()} | 
          CHANNELS: ${document.querySelector('input[name="channels"]:checked').value.toUpperCase()}<br/>
          SIZE: ${originalSize} MB → ${processedSize} MB
        `;

        const url = URL.createObjectURL(file);
        audioPlayer.src = url;
        audioPlayer.play();
        await new Promise(res => setTimeout(res, 1000)); // симуляция обработки
      }

      // заполняем оставшиеся сегменты, если остались
      const remaining = totalSegments - (segmentsPerFile * files.length);
      const finalStart = segmentsPerFile * files.length;
      const finalEnd = finalStart + remaining - 1;
      if (remaining > 0) {
        await animateSegments(finalStart, finalEnd);
      }

      setTimeout(() => {
        progressOverlay.style.display = "none";
      }, 500);
    }

    async function animateSegments(start, end) {
      const segments = document.querySelectorAll(".progress-segment");
      for (let i = start; i <= end; i++) {
        if (segments[i]) {
          segments[i].classList.add("active");
          await new Promise(res => setTimeout(res, 80));
        }
      }
    }
  </script>
</body>
</html>